---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

# Make package functions available during render without installing
if (requireNamespace("devtools", quietly = TRUE)) {
  devtools::load_all(".")
}
set.seed(123)

```

# synthsensor

<!-- badges: start -->
[![R-CMD-check](https://github.com/AstridMarie2/synthsensor/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/AstridMarie2/synthsensor/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

**synthsensor** generates **labeled, two-sensor synthetic time series** for benchmarking sensor diagnostics and uncertainty methods.
It supports configurable background signals (AR(1), random walk, Poisson moving average, sine), **delay/attenuation**, **noise & bias, spikes** (correlated/uncorrelated), and **drifts**, and outputs per-timestep **anomaly flags** and **true error** proxies.

- Reproducible datasets for detection/diagnostics research
- Scriptable functions **and** an interactive Shiny app
- Labeled outputs for supervised and rule-based evaluation

## Installation

Development version from GitHub:

``` r
# install.packages("remotes")
remotes::install_github("AstridMarie2/synthsensor")
```

Or work from source during development:

``` r
# install.packages("remotes")
devtools::load_all(".")
```


## Anomaly flags
AnomalyFlag1/2 are factors with levels:
Normal, Drift, Spike, Both, SpikeCorr
**Overlap rule**: any Drift overlapping with Spike or SpikeCorr is labeled Both.
**Correlation**: windows injected as “correlated spikes” are flagged SpikeCorr on both sensors.


## Minimal example

Generate a short dataset with a AR(1) background, Gaussian noise, delay and attenuation for sensor1, a drifting period in sensor 2, and a few uncorrelated spikes for both sensors:

```{r example}
library(synthsensor)

df <- generate_data_function(
    n = 300,
    # Background signal
    add_background   = TRUE,
    background_type  = "AR(1) Process", # Select between "Poisson Moving Average", "Random Walk", "Sine Wave", "AR(1) Process" and 
    background_phi = 0.97, # Autocorrelation (in time)
    background_rho = 1, # Correlation between sensors
    # Noise parameters
    sd1 = 0.15, sd2 = 0.15,
    crosscor_noise   = 0,
    mean1 = 10, mean2 = 10,
    # Anomalies
    n_spikes_corr    = 0,
    n_spikes_s1      = 3,
    n_spikes_s2      = 2,
    max_spike_length = 6,
    n_drifts_s1      = 0,
    n_drifts_s2      = 1,
    drift_duration   = c(75, 100), # Drift duration range
    drift_slope      = c(1, 2), # Drift slope range
    # Delay
    delayed_sensor   = "Sensor1", # "None", "Sensor1" or "Sensor2"
    alpha_ema        = 0.3 # For selected delayed sensor
)

head(df)


```

Quick look at the series and labels:
```{r}
plot(df$Time, df$Sensor1, type = "l", col = "blue", lwd = 2, ylim = range(c(df$Sensor1, df$Sensor2)),
         main = "Synthetic sensor data",
         ylab = "Reading", xlab = "Time", lty = 1)
    lines(df$Sensor2, col = "red", lwd = 2, lty = 2)
    legend("topright", legend = c("Sensor 1", "Sensor 2"), col = c("blue", "red"), lty = c(1,2))
    
table(Anom1 = df$AnomalyFlag1)
table(Anom2 = df$AnomalyFlag2)

```

# Shiny app
Launch the interactive shiny app:
```{r}
# synthsensor::app_synth()
```
The app lets you configure parameters, visualize results, and export CSV with labels.

# Testing
Run the automated tests:
```{r}
devtools::test()
```
Continuous Integration runs R CMD check and tests on pushes/PRs (see the badge above).


# Citation
If you use **synthsensor** in research, please cite the software (Zenodo DOI) and the JOSS paper (once available).

# Community Guidelines

We welcome feedback, bug reports, and contributions from the community. To keep things clear and productive:

## Contributing
- Contributions are welcome via pull requests on [GitHub](https://github.com/AstridMarie2/synthsensor).
- Please open an issue first if you plan a significant change, so we can discuss it.
- Follow the existing code style and include tests for new functionality when possible.

## Reporting Issues
- If you encounter a bug, unexpected behavior, or documentation error, please open an issue on the [issue tracker](https://github.com/AstridMarie2/synthsensor/issues).
- Include as much detail as possible: R version, operating system, and minimal reproducible code if applicable.

## Seeking Support
- Usage questions or requests for clarification can also be raised through the [issue tracker](https://github.com/AstridMarie2/synthsensor/issues).
- For general R or Shiny questions, consider also checking [Stack Overflow](https://stackoverflow.com/questions/tagged/r) with the `r` and `shiny` tags.

## Code of Conduct
- Please be respectful and constructive in all interactions.
- We follow the [Contributor Covenant](https://www.contributor-covenant.org/) Code of Conduct.

# Licence
MIT (C) Astrid Marie Skålvik
